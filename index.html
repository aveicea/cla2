<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Î©ÄÌã∞ Ï∫òÎ¶∞Îçî Î∑∞Ïñ¥</title>
<style>
/* CSS Ïä§ÌÉÄÏùº - ÏõêÎ≥∏ Í∑∏ÎåÄÎ°ú Ïú†ÏßÄ */
:root {
  --accent-color: #D1D1D1;
  --accent-hover-color: #3367d6;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background-color: #f5f5f5;
  color: #333;
  height: 100vh;
  overflow: hidden;
}

.header {
  background: white;
  padding: 15px 20px;
  border-bottom: 1px solid #e0e0e0;
  display: flex;
  justify-content: space-between;
  align-items: center;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.view-selector {
  display: flex;
  gap: 5px;
}

.view-btn {
  background: #f8f9fa;
  border: 1px solid #e0e0e0;
  padding: 8px 16px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 14px;
  transition: all 0.2s ease;
}

.view-btn:hover {
  background-color: var(--accent-hover-color);
  color: white;
  border-color: var(--accent-hover-color);
}

.view-btn.active {
  background-color: var(--accent-color);
  color: white;
  border-color: var(--accent-color);
}

.nav-controls {
  display: flex;
  align-items: center;
  gap: 10px;
}

.nav-btn {
  background: white;
  border: 1px solid #e0e0e0;
  padding: 8px 12px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 16px;
  transition: all 0.2s ease;
}

.nav-btn:hover {
  background-color: var(--accent-hover-color);
  color: white;
  border-color: var(--accent-hover-color);
}

.current-date {
  font-weight: bold;
  font-size: 18px;
  min-width: 200px;
  text-align: center;
}

.settings-btn {
  background: var(--accent-color);
  color: white;
  border: none;
  padding: 10px 15px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 16px;
  transition: all 0.2s ease;
}

.settings-btn:hover {
  background-color: var(--accent-hover-color);
}

.settings-panel {
  position: fixed;
  top: 0;
  right: -400px;
  width: 400px;
  height: 100vh;
  background: white;
  box-shadow: -2px 0 10px rgba(0,0,0,0.3);
  transition: right 0.3s ease;
  z-index: 1000;
  overflow-y: auto;
  padding: 20px;
}

.settings-panel[style*="block"] {
  right: 0;
}

.overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.5);
  z-index: 999;
  display: none;
}

.settings-title {
  font-size: 20px;
  font-weight: bold;
  margin-bottom: 20px;
  color: #333;
  border-bottom: 2px solid var(--accent-color);
  padding-bottom: 10px;
}

.toggle-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  cursor: pointer;
  padding: 12px 0;
  border-bottom: 1px solid #e0e0e0;
  margin-bottom: 10px;
}

.toggle-header:hover {
  background-color: #f8f9fa;
}

.color-picker-title {
  font-weight: 600;
  color: #333;
}

.toggle-icon {
  font-size: 16px;
  transition: transform 0.3s ease;
}

.toggle-icon.expanded {
  transform: rotate(180deg);
}

.toggle-content {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.3s ease;
  margin-bottom: 15px;
}

.toggle-content.expanded {
  max-height: 500px;
}

.color-input-row {
  display: flex;
  gap: 10px;
  margin-bottom: 10px;
}

.color-picker-input {
  width: 50px;
  height: 35px;
  border: 1px solid #e0e0e0;
  border-radius: 6px;
  cursor: pointer;
}

.color-text-input {
  flex: 1;
  padding: 8px 12px;
  border: 1px solid #e0e0e0;
  border-radius: 6px;
  font-size: 14px;
}

.preset-colors {
  display: grid;
  grid-template-columns: repeat(6, 1fr);
  gap: 8px;
}

.preset-color {
  width: 35px;
  height: 35px;
  border-radius: 6px;
  cursor: pointer;
  border: 2px solid transparent;
  transition: transform 0.2s ease;
}

.preset-color:hover {
  transform: scale(1.1);
  border-color: #666;
}

.input-group {
  margin-bottom: 15px;
}

.input-group label {
  display: block;
  margin-bottom: 5px;
  font-weight: 600;
  color: #333;
}

.input-group input, .input-group select, .input-group textarea {
  width: 100%;
  padding: 8px 12px;
  border: 1px solid #e0e0e0;
  border-radius: 6px;
  font-size: 14px;
}

.help-text {
  font-size: 12px;
  color: #666;
  margin-top: 5px;
  line-height: 1.4;
}

.calendar-inputs {
  display: none;
}

.calendar-inputs.active {
  display: block;
}

.btn {
  padding: 10px 16px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-size: 14px;
  font-weight: 600;
  transition: all 0.2s ease;
}

.btn-primary {
  background: var(--accent-color);
  color: white;
}

.btn-primary:hover {
  background: var(--accent-hover-color);
}

.btn-secondary {
  background: #f8f9fa;
  color: #333;
  border: 1px solid #e0e0e0;
}

.btn-secondary:hover {
  background: #e9ecef;
}

.calendar-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 12px;
  margin-bottom: 8px;
  border: 1px solid #e0e0e0;
  border-radius: 8px;
  background: white;
  transition: all 0.2s ease;
}

.calendar-item:hover {
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.calendar-item.active {
  border-color: var(--accent-color);
  background-color: #f8f9ff;
}

.calendar-color-picker {
  width: 30px;
  height: 30px;
  border: none;
  border-radius: 50%;
  cursor: pointer;
}

.calendar-info {
  flex: 1;
}

.calendar-name {
  font-weight: 600;
  font-size: 14px;
  border: none;
  background: transparent;
  color: #333;
  margin-bottom: 2px;
}

.calendar-url {
  font-size: 12px;
  color: #666;
  margin-bottom: 2px;
}

.calendar-status {
  font-size: 11px;
  padding: 2px 6px;
  border-radius: 4px;
  font-weight: 600;
}

.calendar-status.success {
  background: #d4edda;
  color: #155724;
}

.calendar-status.loading {
  background: #fff3cd;
  color: #856404;
}

.calendar-status.error {
  background: #f8d7da;
  color: #721c24;
}

.calendar-actions {
  display: flex;
  gap: 5px;
}

.toggle-btn {
  background: none;
  border: 1px solid #e0e0e0;
  padding: 5px 8px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 12px;
  transition: all 0.2s ease;
}

.toggle-btn:hover {
  background: #f8f9fa;
}

.remove-btn:hover {
  background: #f8d7da;
  color: #721c24;
}

.view-calendar-section {
  margin-bottom: 15px;
}

.view-calendar-list {
  display: flex;
  flex-direction: column;
  gap: 5px;
  margin-bottom: 8px;
}

.view-calendar-item {
  display: flex;
  align-items: center;
  font-size: 13px;
  cursor: pointer;
}

.debug-log {
  max-height: 200px;
  overflow-y: auto;
  background: #f8f9fa;
  border: 1px solid #e0e0e0;
  border-radius: 6px;
  padding: 10px;
  font-family: monospace;
  font-size: 12px;
  margin-top: 10px;
}

.debug-log div {
  margin-bottom: 2px;
  padding: 2px 0;
  border-bottom: 1px solid #eee;
}

.calendar-container {
  flex: 1;
  overflow: auto;
  height: calc(100vh - 80px);
}

.calendar-content {
  padding: 20px;
}

.loading {
  text-align: center;
  padding: 50px;
  font-size: 18px;
  color: #666;
}

/* Ï∫òÎ¶∞Îçî Î∑∞ Ïä§ÌÉÄÏùº */
.calendar-grid {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 1px;
  background: #e0e0e0;
  border: 1px solid #e0e0e0;
}

.calendar-grid.month-view {
  grid-template-rows: 40px repeat(6, 1fr);
  height: 600px;
}

.week-header {
  background: #f8f9fa;
  padding: 10px;
  text-align: center;
  font-weight: bold;
  font-size: 14px;
  border-right: 1px solid #e0e0e0;
}

.calendar-day {
  background: white;
  padding: 8px;
  min-height: 100px;
  position: relative;
}

.calendar-day.today {
  background: var(--accent-color);
  color: white;
}

.calendar-day.other-month {
  background: #f8f9fa;
  color: #999;
}

.day-number {
  font-weight: bold;
  margin-bottom: 5px;
}

.event {
  background: #4285f4;
  color: white;
  padding: 2px 4px;
  margin: 1px 0;
  border-radius: 3px;
  font-size: 11px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  cursor: pointer;
}

.time-based-view {
  background: white;
  border: 1px solid #e0e0e0;
}

.time-slot {
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  color: #666;
}

.day-cell {
  border-right: 1px solid #e0e0e0;
  border-bottom: 1px solid #e0e0e0;
  min-height: 25px;
}

.all-day-event {
  font-weight: 500;
  z-index: 10;
}

.time-event {
  font-weight: 500;
  border-left: 3px solid rgba(255,255,255,0.3);
}
</style>
</head>
<body>
<div class="header">
  <div class="view-selector">
    <button class="view-btn active" onclick="setView('day')" id="dayBtn">Ïùº</button>
    <button class="view-btn" onclick="setView('week')" id="weekBtn">Ï£º</button>
    <button class="view-btn" onclick="setView('month')" id="monthBtn">Ïõî</button>
  </div>
  
  <div class="nav-controls">
    <button class="nav-btn" onclick="navigateCalendar(-1)">‚Äπ</button>
    <div class="current-date" id="currentDate"></div>
    <button class="nav-btn" onclick="navigateCalendar(1)">‚Ä∫</button>
    <button class="nav-btn" onclick="goToToday()">üìÖ</button>
  </div>
  
  <button class="settings-btn" onclick="toggleSettings()">‚öôÔ∏è</button>
  
  <div class="settings-panel" id="settingsPanel">
    <div class="settings-title">Î©ÄÌã∞ Ï∫òÎ¶∞Îçî ÏÑ§Ï†ï</div>

<!-- Î∑∞Î≥Ñ Ï∫òÎ¶∞Îçî ÏÑ†ÌÉù -->
<div class="view-calendar-section">
  <div class="toggle-header" onclick="toggleSection('viewCalendarSettings', 'viewToggleIcon')">
    <div class="color-picker-title">Î∑∞Î≥Ñ Ï∫òÎ¶∞Îçî ÏÑ†ÌÉù</div>
    <div class="toggle-icon" id="viewToggleIcon">‚ñº</div>
  </div>
  <div class="toggle-content" id="viewCalendarSettings">
    <!-- ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±Îê® -->
  </div>
</div>

<!-- ÌÖåÎßà ÏÉâÏÉÅ -->
<div class="color-picker-group">
  <div class="toggle-header" onclick="toggleSection('themeColorContent', 'themeToggleIcon')">
    <div class="color-picker-title">ÌÖåÎßà ÏÉâÏÉÅ</div>
    <div class="toggle-icon" id="themeToggleIcon">‚ñº</div>
  </div>
  <div class="toggle-content" id="themeColorContent">
    <div class="color-input-row">
      <input type="color" class="color-picker-input" id="colorPicker" onchange="updateColorFromPicker()">
      <input type="text" class="color-text-input" id="colorText" placeholder="#D1D1D1" oninput="updateColorFromText()" maxlength="7">
    </div>
    <div class="preset-colors">
      <div class="preset-color" style="background-color: #4285f4;" onclick="setPresetColor('#4285f4')"></div>
      <div class="preset-color" style="background-color: #34a853;" onclick="setPresetColor('#34a853')"></div>
      <div class="preset-color" style="background-color: #ea4335;" onclick="setPresetColor('#ea4335')"></div>
      <div class="preset-color" style="background-color: #ffc107;" onclick="setPresetColor('#ffc107')"></div>
      <div class="preset-color" style="background-color: #9c27b0;" onclick="setPresetColor('#9c27b0')"></div>
      <div class="preset-color" style="background-color: #607d8b;" onclick="setPresetColor('#607d8b')"></div>
    </div>
  </div>
</div>

<!-- Ïó∞ÎèôÎêú Ï∫òÎ¶∞Îçî Î™©Î°ù -->
<div class="calendar-list-section">
  <div class="toggle-header" onclick="toggleSection('calendarListContent', 'listToggleIcon')">
    <div class="color-picker-title">Ïó∞ÎèôÎêú Ï∫òÎ¶∞Îçî Î™©Î°ù</div>
    <div style="display: flex; align-items: center; gap: 8px;">
      <button class="nav-btn" onclick="refreshAllCalendars()" title="Î™®Îì† Ï∫òÎ¶∞Îçî ÏÉàÎ°úÍ≥†Ïπ®">üîÑ</button>
      <div class="toggle-icon" id="listToggleIcon">‚ñº</div>
    </div>
  </div>
  <div class="toggle-content" id="calendarListContent">
    <div id="calendarList">
      <p style="color: #666; font-size: 12px; text-align: center; padding: 20px;">
        Ïó∞ÎèôÎêú Ï∫òÎ¶∞ÎçîÍ∞Ä ÏóÜÏäµÎãàÎã§.<br>ÏïÑÎûòÏóêÏÑú Ï∫òÎ¶∞ÎçîÎ•º Ï∂îÍ∞ÄÌï¥Î≥¥ÏÑ∏Ïöî!
      </p>
    </div>
  </div>
</div>

<!-- Ï∫òÎ¶∞Îçî Ï∂îÍ∞Ä -->
<div class="add-calendar-section">
  <div class="toggle-header" onclick="toggleSection('addCalendarContent', 'addToggleIcon')">
    <div class="color-picker-title">Ï∫òÎ¶∞Îçî Ï∂îÍ∞Ä</div>
    <div class="toggle-icon" id="addToggleIcon">‚ñº</div>
  </div>
  <div class="toggle-content" id="addCalendarContent">
    <div class="input-group">
      <label>Ï∫òÎ¶∞Îçî Ïú†Ìòï</label>
      <select id="calendarType" onchange="updateCalendarInputs()">
        <option value="ical">iCal ÎßÅÌÅ¨ (.ics)</option>
        <option value="googlePublic">Íµ¨Í∏Ä Ï∫òÎ¶∞Îçî Í≥µÍ∞ú ÎßÅÌÅ¨</option>
        <option value="api">Íµ¨Í∏Ä Ï∫òÎ¶∞Îçî API</option>
      </select>
    </div>
    
    <div class="input-group">
      <label>Ï∫òÎ¶∞Îçî Ïù¥Î¶Ñ</label>
      <input type="text" id="calendarName" placeholder="Ïòà: Í∞úÏù∏ ÏùºÏ†ï, ÏóÖÎ¨¥ Ï∫òÎ¶∞Îçî">
    </div>
    
    <div class="input-group">
      <label>Ï∫òÎ¶∞Îçî ÏÉâÏÉÅ</label>
      <input type="color" id="calendarColor" value="#D1D1D1">
    </div>
    
    <div id="icalInputs" class="calendar-inputs active">
      <div class="input-group">
        <label>iCal ÎßÅÌÅ¨</label>
        <textarea id="icalUrl" rows="3" placeholder="https://calendar.google.com/calendar/ical/.../basic.ics"></textarea>
        <div class="help-text">
          Íµ¨Í∏Ä Ï∫òÎ¶∞Îçî ÏÑ§Ï†ï ‚Üí ÌÜµÌï© Î∞è Í≥µÏú† ‚Üí ÎπÑÍ≥µÍ∞ú Ï£ºÏÜåÏùò iCal ÎßÅÌÅ¨Î•º Î≥µÏÇ¨ÌïòÏÑ∏Ïöî.
        </div>
      </div>
    </div>
    
    <div id="googlePublicInputs" class="calendar-inputs">
      <div class="input-group">
        <label>Íµ¨Í∏Ä Ï∫òÎ¶∞Îçî ID</label>
        <input type="text" id="googleCalendarId" placeholder="Ï∫òÎ¶∞ÎçîID@group.calendar.google.com">
        <div class="help-text">
          Í≥µÍ∞úÎêú Íµ¨Í∏Ä Ï∫òÎ¶∞ÎçîÏùò Ï∫òÎ¶∞Îçî IDÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî.<br>
          Ïòà: ko.south_korea#holiday@group.v.calendar.google.com (ÌïúÍµ≠ Í≥µÌú¥Ïùº)
        </div>
      </div>
    </div>
    
    <div id="apiInputs" class="calendar-inputs">
      <div class="input-group">
        <label>API ÌÇ§</label>
        <input type="text" id="apiKey" placeholder="Google Calendar API ÌÇ§">
      </div>
      <div class="input-group">
        <label>Ï∫òÎ¶∞Îçî ID</label>
        <input type="text" id="calendarId" placeholder="primary ÎòêÎäî Ïù¥Î©îÏùº@gmail.com">
      </div>
    </div>
    
    <button class="btn btn-primary" onclick="addCalendar()">Ï∫òÎ¶∞Îçî Ï∂îÍ∞Ä</button>
  </div>
</div>

    <div class="backup-section">
      <div class="color-picker-title">ÏÑ§Ï†ï Î∞±ÏóÖ/Î≥µÏõê</div>
      <div style="display: flex; gap: 8px; margin-bottom: 10px;">
        <button class="btn btn-primary" onclick="exportCalendarSettings()">ÏÑ§Ï†ï ÎÇ¥Î†§Î∞õÍ∏∞</button>
        <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()">ÏÑ§Ï†ï Í∞ÄÏ†∏Ïò§Í∏∞</button>
      </div>
      <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importCalendarSettings(this)">
      <div style="font-size: 11px; color: #666; margin-top: 5px;">
        Ï∫òÎ¶∞Îçî Ïó∞Îèô Ï†ïÎ≥¥, ÏÉâÏÉÅ, Î∑∞ ÏÑ§Ï†ï Îì±ÏùÑ Î∞±ÏóÖÌïòÍ≥† Î≥µÏõêÌï† Ïàò ÏûàÏäµÎãàÎã§.
      </div>
    </div>
    
    <div class="debug-section">
      <div class="color-picker-title">ÎîîÎ≤ÑÍ∑∏ Ï†ïÎ≥¥</div>
      <button class="btn btn-secondary" onclick="clearDebugLog()">Î°úÍ∑∏ ÏßÄÏö∞Í∏∞</button>
      <div id="debugLog" class="debug-log"></div>
    </div>
  </div>
</div>

<div class="overlay" id="overlay" onclick="closeSettings()"></div>

<div class="calendar-container">
  <div class="calendar-content" id="calendarContent">
    <div class="loading">Ï∫òÎ¶∞ÎçîÎ•º Î∂àÎü¨Ïò§Îäî Ï§ë...</div>
  </div>
</div>

<script>
// ========================================
// Ï†ÑÏó≠ Î≥ÄÏàò ÏÑ†Ïñ∏
// ========================================
let currentView = 'day';
let currentDate = new Date();
let accentColor = '#D1D1D1';
let accentHoverColor = '#3367d6';
let calendars = [];
let debugMessages = [];
let viewCalendarSettings = {
  day: [],
  week: [],
  month: []
};

// ÏÉÅÏàò Ï†ïÏùò
const CALENDAR_COLORS = ['#4285f4', '#34a853', '#ea4335', '#ffc107', '#9c27b0', '#607d8b'];
const SLOT_START_HOUR = 6;
const TOTAL_HOURS = 24;
const SLOT_COUNT = TOTAL_HOURS;
const WEEKDAYS = ['Ïùº', 'Ïõî', 'Ìôî', 'Ïàò', 'Î™©', 'Í∏à', 'ÌÜ†'];

// DOM ÏöîÏÜå Ï∞∏Ï°∞
const settingsPanel = document.getElementById("settingsPanel");
const overlay = document.getElementById("overlay");
const colorPicker = document.getElementById("colorPicker");
const colorText = document.getElementById("colorText");
const currentDateElement = document.getElementById("currentDate");
const calendarContent = document.getElementById("calendarContent");
const calendarList = document.getElementById("calendarList");
const debugLog = document.getElementById("debugLog");

// ========================================
// Ïú†Ìã∏Î¶¨Ìã∞ Ìï®ÏàòÎì§
// ========================================
function addDebugLog(message) {
  const timestamp = new Date().toLocaleTimeString();
  debugMessages.push(`[${timestamp}] ${message}`);
  if (debugMessages.length > 50) debugMessages.shift();
  
  if (debugLog) {
    debugLog.innerHTML = debugMessages.map(msg => `<div>${msg}</div>`).join('');
    debugLog.scrollTop = debugLog.scrollHeight;
  }
  console.log(message);
}

function clearDebugLog() {
  debugMessages = [];
  if (debugLog) debugLog.innerHTML = '';
}

function darkenColor(hex, percent) {
  const num = parseInt(hex.replace("#", ""), 16);
  const amt = Math.round(2.55 * percent);
  const R = (num >> 16) - amt;
  const G = (num >> 8 & 0x00FF) - amt;
  const B = (num & 0x0000FF) - amt;
  return "#" + (0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
    (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
    (B < 255 ? B < 1 ? 0 : B : 255)).toString(16).slice(1);
}

function toggleSection(contentId, iconId) {
  const content = document.getElementById(contentId);
  const icon = document.getElementById(iconId);
  
  content.classList.toggle('expanded');
  icon.classList.toggle('expanded');
}

function getRandomId() {
  return Date.now().toString() + Math.random().toString(36).substr(2, 9);
}

// ========================================
// Ï¥àÍ∏∞Ìôî Ìï®ÏàòÎì§
// ========================================
function init() {
  loadFromStorage();
  updateCurrentDateDisplay();
  setAccentColor(accentColor);
  updateCalendarList();
  renderCalendar();
  setupEventListeners();
  setupAutoRefresh();
  addDebugLog('Ï∫òÎ¶∞Îçî Î∑∞Ïñ¥Í∞Ä ÏãúÏûëÎêòÏóàÏäµÎãàÎã§.');
}

function setupEventListeners() {
  // ÌÇ§Î≥¥Îìú Îã®Ï∂ïÌÇ§
  document.addEventListener('keydown', handleKeyboardShortcuts);
  
  // Ï∫òÎ¶∞Îçî ÏÉâÏÉÅ ÏûêÎèô Ìï†Îãπ
  document.getElementById('calendarColor').addEventListener('focus', function() {
    this.value = CALENDAR_COLORS[calendars.length % CALENDAR_COLORS.length];
  });
}

function setupAutoRefresh() {
  setInterval(async () => {
    for (const calendar of calendars) {
      if (calendar.type !== 'sample' && calendar.visible) {
        try {
          const oldEventCount = calendar.events.length;
          await loadCalendarEvents(calendar);
          if (calendar.events.length !== oldEventCount) {
            renderCalendar();
            addDebugLog(`ÏÉà ÏùºÏ†ï Í∞êÏßÄ: ${calendar.name}`);
          }
        } catch (error) {
          // Ï°∞Ïö©Ìûà Ïã§Ìå® Ï≤òÎ¶¨
        }
      }
    }
  }, 120000); // 2Î∂ÑÎßàÎã§ Ï≤¥ÌÅ¨
}

// ========================================
// UI Í¥ÄÎ¶¨ Ìï®ÏàòÎì§
// ========================================
function toggleSettings() {
  const isVisible = settingsPanel.style.display === 'block';
  if (isVisible) {
    closeSettings();
  } else {
    openSettings();
  }
}

function openSettings() {
  settingsPanel.style.display = 'block';
  overlay.style.display = 'block';
}

function closeSettings() {
  settingsPanel.style.display = 'none';
  overlay.style.display = 'none';
}

function updateCurrentDateDisplay() {
  let formatted;
  
  if (currentView === 'day') {
    const options = { month: 'long', day: 'numeric', weekday: 'short' };
    formatted = currentDate.toLocaleDateString('ko-KR', options);
    formatted = formatted.replace(/(\d+Ïùº)\s*(\([^)]+\))/, '$1 $2');
  } else {
    const options = { year: 'numeric', month: 'long' };
    formatted = currentDate.toLocaleDateString('ko-KR', options);
  }
  
  currentDateElement.textContent = formatted;
}

function handleKeyboardShortcuts(e) {
  if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
  
  switch(e.key) {
    case 'ArrowLeft':
      navigateCalendar(-1);
      e.preventDefault();
      break;
    case 'ArrowRight':
      navigateCalendar(1);
      e.preventDefault();
      break;
    case 't':
    case 'T':
      goToToday();
      break;
    case 'm':
    case 'M':
      setView('month');
      break;
    case 'w':
    case 'W':
      setView('week');
      break;
    case 'd':
    case 'D':
      setView('day');
      break;
    case 'Escape':
      closeSettings();
      break;
  }
}

// ========================================
// Î∑∞ Í¥ÄÎ¶¨ Ìï®ÏàòÎì§
// ========================================
function setView(viewMode) {
  currentView = viewMode;
  document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
  document.getElementById(viewMode + 'Btn').classList.add('active');
  updateCurrentDateDisplay();
  renderCalendar();
  saveToStorage();
}

function navigateCalendar(direction) {
  if (currentView === 'month') {
    currentDate.setMonth(currentDate.getMonth() + direction);
  } else if (currentView === 'week') {
    currentDate.setDate(currentDate.getDate() + (direction * 7));
  } else if (currentView === 'day') {
    currentDate.setDate(currentDate.getDate() + direction);
  }
  updateCurrentDateDisplay();
  renderCalendar();
}

function goToToday() {
  currentDate = new Date();
  updateCurrentDateDisplay();
  renderCalendar();
}

// ========================================
// ÏÉâÏÉÅ Í¥ÄÎ¶¨ Ìï®ÏàòÎì§
// ========================================
function setAccentColor(color) {
  accentColor = color;
  accentHoverColor = darkenColor(color, 15);
  
  document.documentElement.style.setProperty('--accent-color', color);
  document.documentElement.style.setProperty('--accent-hover-color', accentHoverColor);
  
  if (colorPicker) colorPicker.value = color;
  if (colorText) colorText.value = color.toUpperCase();
  
  saveToStorage();
}

function setPresetColor(color) {
  setAccentColor(color);
}

function updateColorFromPicker() {
  setAccentColor(colorPicker.value);
}

function updateColorFromText() {
  let color = colorText.value.trim();
  if (!color.startsWith('#')) color = '#' + color;
  if (/^#[0-9A-F]{6}$/i.test(color)) {
    setAccentColor(color);
  }
}

// ========================================
// Ï∫òÎ¶∞Îçî Í¥ÄÎ¶¨ Ìï®ÏàòÎì§
// ========================================
function updateCalendarInputs() {
  const type = document.getElementById('calendarType').value;
  
  document.querySelectorAll('.calendar-inputs').forEach(input => {
    input.classList.remove('active');
  });
  
  document.getElementById(type + 'Inputs').classList.add('active');
}

function updateCalendarStatus(calendarId, status, message = '') {
  const calendar = calendars.find(c => c.id === calendarId);
  if (calendar) {
    calendar.status = status;
    calendar.statusMessage = message;
    updateCalendarList();
  }
}

function updateCalendarColor(calendarId, newColor) {
  const calendar = calendars.find(c => c.id === calendarId);
  if (calendar) {
    calendar.color = newColor;
    renderCalendar();
    saveToStorage();
    addDebugLog(`Ï∫òÎ¶∞Îçî ÏÉâÏÉÅ Î≥ÄÍ≤Ω: ${calendar.name} ‚Üí ${newColor}`);
  }
}

function updateCalendarName(calendarId, newName) {
  const calendar = calendars.find(c => c.id === calendarId);
  if (calendar && newName.trim()) {
    calendar.name = newName.trim();
    saveToStorage();
    addDebugLog(`Ï∫òÎ¶∞Îçî Ïù¥Î¶Ñ Î≥ÄÍ≤Ω: ${newName}`);
  }
}

function updateCalendarList() {
  if (calendars.length === 0) {
    calendarList.innerHTML = `
      <p style="color: #666; font-size: 12px; text-align: center; padding: 20px;">
        Ïó∞ÎèôÎêú Ï∫òÎ¶∞ÎçîÍ∞Ä ÏóÜÏäµÎãàÎã§.<br>ÏÉòÌîå Ï∫òÎ¶∞ÎçîÎ•º Ï∂îÍ∞ÄÌïòÍ±∞ÎÇò ÏïÑÎûòÏóêÏÑú Ï∫òÎ¶∞ÎçîÎ•º Ï∂îÍ∞ÄÌï¥Î≥¥ÏÑ∏Ïöî!
      </p>
    `;
    return;
  }
  
  calendarList.innerHTML = calendars.map(calendar => `
    <div class="calendar-item ${calendar.visible ? 'active' : ''}" data-id="${calendar.id}">
      <input type="color" value="${calendar.color}" 
             onchange="updateCalendarColor('${calendar.id}', this.value)" 
             class="calendar-color-picker" 
             title="Ï∫òÎ¶∞Îçî ÏÉâÏÉÅ Î≥ÄÍ≤Ω">
      <div class="calendar-info">
        <input class="calendar-name" value="${calendar.name}" 
               onchange="updateCalendarName('${calendar.id}', this.value)"
               onblur="updateCalendarName('${calendar.id}', this.value)">
        <div class="calendar-url">${calendar.type === 'sample' ? 'ÏÉòÌîå Îç∞Ïù¥ÌÑ∞' : 
          (calendar.url || calendar.calendarId || '').substring(0, 30)}${(calendar.url || calendar.calendarId || '').length > 30 ? '...' : ''}</div>
        <div class="calendar-status ${calendar.status}">${calendar.statusMessage || calendar.status}</div>
      </div>
      <div class="calendar-actions">
        <button class="toggle-btn ${calendar.visible ? 'visible' : 'hidden'}" 
                onclick="toggleCalendarVisibility('${calendar.id}')" 
                title="${calendar.visible ? 'Ïà®Í∏∞Í∏∞' : 'Î≥¥Ïù¥Í∏∞'}">
          ${calendar.visible ? 'üëÅÔ∏è' : 'üö´'}
        </button>
        <button class="toggle-btn reload-btn" onclick="reloadCalendar('${calendar.id}')" title="ÏÉàÎ°úÍ≥†Ïπ®">üîÑ</button>
        <button class="toggle-btn remove-btn" onclick="removeCalendar('${calendar.id}')" title="ÏÇ≠Ï†ú">‚ùå</button>
      </div>
    </div>
  `).join('');
  
  updateViewCalendarSettings();
}

function toggleCalendarVisibility(calendarId) {
  const calendar = calendars.find(c => c.id === calendarId);
  if (calendar) {
    calendar.visible = !calendar.visible;
    updateCalendarList();
    renderCalendar();
    saveToStorage();
    addDebugLog(`Ï∫òÎ¶∞Îçî Í∞ÄÏãúÏÑ± Î≥ÄÍ≤Ω: ${calendar.name} - ${calendar.visible ? 'Î≥¥ÏûÑ' : 'Ïà®ÍπÄ'}`);
  }
}

function removeCalendar(calendarId) {
  const calendar = calendars.find(c => c.id === calendarId);
  if (calendar) {
    calendars = calendars.filter(c => c.id !== calendarId);
    updateCalendarList();
    renderCalendar();
    saveToStorage();
    addDebugLog(`Ï∫òÎ¶∞Îçî ÏÇ≠Ï†úÎê®: ${calendar.name}`);
  }
}

async function reloadCalendar(calendarId) {
  const calendar = calendars.find(c => c.id === calendarId);
  if (!calendar) return;
  
  if (calendar.type === 'sample') {
    calendar.events = generateSampleEvents();
    updateCalendarStatus(calendarId, 'success', `${calendar.events.length}Í∞ú Ïù¥Î≤§Ìä∏`);
    renderCalendar();
    saveToStorage();
    addDebugLog(`ÏÉòÌîå Ï∫òÎ¶∞Îçî ÏÉàÎ°úÍ≥†Ïπ® ÏôÑÎ£å: ${calendar.name}`);
    return;
  }
  
  updateCalendarStatus(calendarId, 'loading', 'ÏÉàÎ°úÍ≥†Ïπ® Ï§ë...');
  addDebugLog(`Ï∫òÎ¶∞Îçî ÏÉàÎ°úÍ≥†Ïπ®: ${calendar.name}`);
  
  try {
    calendar.events = [];
    await loadCalendarEvents(calendar);
    updateCalendarStatus(calendarId, 'success', `${calendar.events.length}Í∞ú Ïù¥Î≤§Ìä∏`);
    renderCalendar();
    saveToStorage();
    addDebugLog(`Ï∫òÎ¶∞Îçî ÏÉàÎ°úÍ≥†Ïπ® ÏôÑÎ£å: ${calendar.name}`);
  } catch (error) {
    updateCalendarStatus(calendarId, 'error', error.message);
    addDebugLog(`Ï∫òÎ¶∞Îçî ÏÉàÎ°úÍ≥†Ïπ® Ïã§Ìå®: ${calendar.name} - ${error.message}`);
  }
}

async function refreshAllCalendars() {
  addDebugLog('Î™®Îì† Ï∫òÎ¶∞Îçî ÏÉàÎ°úÍ≥†Ïπ® ÏãúÏûë');
  
  for (const calendar of calendars) {
    if (calendar.type !== 'sample') {
      updateCalendarStatus(calendar.id, 'loading', 'ÏÉàÎ°úÍ≥†Ïπ® Ï§ë...');
      try {
        calendar.events = [];
        await loadCalendarEvents(calendar);
        updateCalendarStatus(calendar.id, 'success', `${calendar.events.length}Í∞ú Ïù¥Î≤§Ìä∏`);
      } catch (error) {
        updateCalendarStatus(calendar.id, 'error', error.message);
        addDebugLog(`Ï∫òÎ¶∞Îçî ÏÉàÎ°úÍ≥†Ïπ® Ïã§Ìå®: ${calendar.name} - ${error.message}`);
      }
    }
  }
  
  renderCalendar();
  saveToStorage();
  addDebugLog('Î™®Îì† Ï∫òÎ¶∞Îçî ÏÉàÎ°úÍ≥†Ïπ® ÏôÑÎ£å');
}

async function addCalendar() {
  const type = document.getElementById('calendarType').value;
  const name = document.getElementById('calendarName').value.trim();
  const color = document.getElementById('calendarColor').value;
  
  if (!name) {
    alert('Ï∫òÎ¶∞Îçî Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
    return;
  }
  
  let url = '';
  let calendarId = '';
  let apiKey = '';
  
  if (type === 'ical') {
    url = document.getElementById('icalUrl').value.trim();
    if (!url || !url.includes('.ics')) {
      alert('Ïò¨Î∞îÎ•∏ iCal ÎßÅÌÅ¨Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
      return;
    }
  } else if (type === 'googlePublic') {
    calendarId = document.getElementById('googleCalendarId').value.trim();
    if (!calendarId) {
      alert('Íµ¨Í∏Ä Ï∫òÎ¶∞Îçî IDÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
      return;
    }
  } else if (type === 'api') {
    apiKey = document.getElementById('apiKey').value.trim();
    calendarId = document.getElementById('calendarId').value.trim() || 'primary';
    if (!apiKey) {
      alert('API ÌÇ§Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
      return;
    }
  }
  
  const calendar = {
    id: getRandomId(),
    name: name,
    type: type,
    color: color,
    visible: true,
    url: url,
    calendarId: calendarId,
    apiKey: apiKey,
    events: [],
    status: 'loading',
    statusMessage: 'Î°úÎî© Ï§ë...'
  };
  
  addDebugLog(`Ï∫òÎ¶∞Îçî Ï∂îÍ∞Ä ÏãúÏûë: ${name} (${type})`);
  
  calendars.push(calendar);
  updateCalendarList();
  
  try {
    await loadCalendarEvents(calendar);
    updateCalendarStatus(calendar.id, 'success', `${calendar.events.length}Í∞ú Ïù¥Î≤§Ìä∏`);
    addDebugLog(`Ï∫òÎ¶∞Îçî Î°úÎìú ÏÑ±Í≥µ: ${name}, ${calendar.events.length}Í∞ú Ïù¥Î≤§Ìä∏`);
    renderCalendar();
    saveToStorage();
    
    // ÏûÖÎ†• Ìèº Ï¥àÍ∏∞Ìôî
    clearCalendarInputs();
    closeSettings();
  } catch (error) {
    updateCalendarStatus(calendar.id, 'error', error.message);
    addDebugLog(`Ï∫òÎ¶∞Îçî Î°úÎìú Ïã§Ìå®: ${name} - ${error.message}`);
    alert('Ï∫òÎ¶∞ÎçîÎ•º Î∂àÎü¨Ïò§ÎäîÎç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§: ' + error.message);
  }
}

function clearCalendarInputs() {
  document.getElementById('calendarName').value = '';
  document.getElementById('icalUrl').value = '';
  document.getElementById('googleCalendarId').value = '';
  document.getElementById('apiKey').value = '';
  document.getElementById('calendarId').value = '';
}

// ========================================
// Î∑∞Î≥Ñ Ï∫òÎ¶∞Îçî ÏÑ§Ï†ï Ìï®ÏàòÎì§
// ========================================
function updateViewCalendarSettings() {
  const container = document.getElementById('viewCalendarSettings');
  if (!container) return;
  
  if (calendars.length === 0) {
    container.innerHTML = '<p style="color: #666; font-size: 12px; text-align: center; padding: 10px;">Ïó∞ÎèôÎêú Ï∫òÎ¶∞ÎçîÍ∞Ä ÏóÜÏäµÎãàÎã§.</p>';
    return;
  }
  
  const views = [
    { key: 'day', name: 'ÏùºÍ∞ÑÎ∑∞' },
    { key: 'week', name: 'Ï£ºÍ∞ÑÎ∑∞' },
    { key: 'month', name: 'ÏõîÍ∞ÑÎ∑∞' }
  ];
  
  container.innerHTML = views.map(view => `
    <div class="view-calendar-section">
      <div style="font-weight: bold; margin-bottom: 8px; color: #333;">${view.name}</div>
      <div class="view-calendar-list">
        ${calendars.map(calendar => `
          <label class="view-calendar-item">
            <input type="checkbox" 
                   ${viewCalendarSettings[view.key].includes(calendar.id) ? 'checked' : ''}
                   onchange="toggleViewCalendar('${view.key}', '${calendar.id}')"
                   style="margin-right: 8px;">
            <span class="calendar-color-dot" style="background-color: ${calendar.color}; width: 12px; height: 12px; border-radius: 50%; display: inline-block; margin-right: 6px;"></span>
            <span>${calendar.name}</span>
          </label>
        `).join('')}
      </div>
      <div style="margin-top: 8px;">
        <button class="btn btn-secondary" onclick="selectAllViewCalendars('${view.key}')" style="font-size: 11px; padding: 4px 8px;">Ï†ÑÏ≤¥ ÏÑ†ÌÉù</button>
        <button class="btn btn-secondary" onclick="deselectAllViewCalendars('${view.key}')" style="font-size: 11px; padding: 4px 8px; margin-left: 4px;">Ï†ÑÏ≤¥ Ìï¥Ï†ú</button>
      </div>
    </div>
  `).join('');
}

function toggleViewCalendar(viewType, calendarId) {
  const index = viewCalendarSettings[viewType].indexOf(calendarId);
  if (index > -1) {
    viewCalendarSettings[viewType].splice(index, 1);
  } else {
    viewCalendarSettings[viewType].push(calendarId);
  }
  saveToStorage();
  renderCalendar();
  addDebugLog(`${viewType}Î∑∞ Ï∫òÎ¶∞Îçî ÏÑ§Ï†ï Î≥ÄÍ≤Ω: ${calendarId}`);
}

function selectAllViewCalendars(viewType) {
  viewCalendarSettings[viewType] = calendars.map(cal => cal.id);
  updateViewCalendarSettings();
  saveToStorage();
  renderCalendar();
  addDebugLog(`${viewType}Î∑∞ Î™®Îì† Ï∫òÎ¶∞Îçî ÏÑ†ÌÉù`);
}

function deselectAllViewCalendars(viewType) {
  viewCalendarSettings[viewType] = [];
  updateViewCalendarSettings();
  saveToStorage();
  renderCalendar();
  addDebugLog(`${viewType}Î∑∞ Î™®Îì† Ï∫òÎ¶∞Îçî Ìï¥Ï†ú`);
}

// ========================================
// Ïù¥Î≤§Ìä∏ Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ìï®ÏàòÎì§
// ========================================
async function loadCalendarEvents(calendar) {
  addDebugLog(`Ïù¥Î≤§Ìä∏ Î°úÎìú ÏãúÏûë: ${calendar.name} (${calendar.type})`);
  
  switch (calendar.type) {
    case 'ical':
      await loadIcalEvents(calendar);
      break;
    case 'googlePublic':
      await loadGooglePublicEvents(calendar);
      break;
    case 'api':
      await loadApiEvents(calendar);
      break;
    case 'sample':
      calendar.events = generateSampleEvents();
      break;
  }
}

async function loadIcalEvents(calendar) {
  const proxies = [
    `https://api.allorigins.win/get?url=${encodeURIComponent(calendar.url)}`,
    `https://cors-anywhere.herokuapp.com/${calendar.url}`,
    `https://corsproxy.io/?${encodeURIComponent(calendar.url)}`,
    `https://proxy.cors.sh/${calendar.url}`,
    `https://cors.sh/${calendar.url}`,
    `https://thingproxy.freeboard.io/fetch/${calendar.url}`,
    `https://yacdn.org/proxy/${calendar.url}`
  ];
  
  let lastError = null;
  
  for (const proxyUrl of proxies) {
    try {
      addDebugLog(`ÌîÑÎ°ùÏãú ÏãúÎèÑ: ${proxyUrl.includes('allorigins') ? 'AllOrigins' : proxyUrl.split('/')[2]}`);
      
      const controller = new AbortController();
      const timeoutId = setTimeout(() => controller.abort(), 15000);
      
      const response = await fetch(proxyUrl, {
        method: 'GET',
        headers: {
          'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
          'Accept': 'text/calendar,text/plain,*/*',
          'Cache-Control': 'no-cache'
        },
        signal: controller.signal,
        mode: 'cors'
      });
      
      clearTimeout(timeoutId);
      
      if (!response.ok) {
        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
      }
      
      let icalData;
      
      if (proxyUrl.includes('allorigins')) {
        const data = await response.json();
        icalData = data.contents;
      } else {
        icalData = await response.text();
      }
      
      if (!icalData || typeof icalData !== 'string') {
        throw new Error('ÏùëÎãµÏù¥ ÌÖçÏä§Ìä∏Í∞Ä ÏïÑÎãò');
      }
      
      if (!icalData.includes('BEGIN:VCALENDAR') && !icalData.includes('BEGIN:VEVENT')) {
        throw new Error('Ïú†Ìö®ÌïòÏßÄ ÏïäÏùÄ iCal Îç∞Ïù¥ÌÑ∞');
      }
      
      calendar.events = parseIcalData(icalData);
      addDebugLog(`iCal ÌååÏã± ÏôÑÎ£å: ${calendar.events.length}Í∞ú Ïù¥Î≤§Ìä∏`);
      return;
      
    } catch (error) {
      lastError = error;
      if (error.name === 'AbortError') {
        addDebugLog(`ÌîÑÎ°ùÏãú ÌÉÄÏûÑÏïÑÏõÉ: ${proxyUrl.split('/')[2]}`);
      } else {
        addDebugLog(`ÌîÑÎ°ùÏãú Ïã§Ìå®: ${proxyUrl.split('/')[2]} - ${error.message}`);
      }
      continue;
    }
  }
  
  throw new Error(`Î™®Îì† ÌîÑÎ°ùÏãú Ïã§Ìå®. ÎßàÏßÄÎßâ Ïò§Î•ò: ${lastError.message}`);
}

async function loadGooglePublicEvents(calendar) {
  const timeMin = new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1).toISOString();
  const timeMax = new Date(currentDate.getFullYear(), currentDate.getMonth() + 2, 0).toISOString();
  
  const apiKey = 'AIzaSyBNlYH01_9Hc5S1J9vuFmu2nUqBZJNAXxs';
  const url = `https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(calendar.calendarId)}/events?key=${apiKey}&timeMin=${timeMin}&timeMax=${timeMax}&orderBy=startTime&singleEvents=true`;
  
  try {
    const response = await fetch(url);
    
    if (!response.ok) {
      throw new Error(`API Ïò§Î•ò: ${response.status} - ${response.statusText}`);
    }
    
    const data = await response.json();
    
    if (!data.items) {
      throw new Error('Ïù¥Î≤§Ìä∏ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§');
    }
    
    calendar.events = data.items.map(event => formatGoogleEvent(event, calendar.color));
    addDebugLog(`Íµ¨Í∏Ä Í≥µÍ∞ú Ï∫òÎ¶∞Îçî Î°úÎìú ÏôÑÎ£å: ${calendar.events.length}Í∞ú Ïù¥Î≤§Ìä∏`);
    
  } catch (error) {
    addDebugLog(`Íµ¨Í∏Ä Í≥µÍ∞ú Ï∫òÎ¶∞Îçî Î°úÎìú Ïã§Ìå®: ${error.message}`);
    throw error;
  }
}

async function loadApiEvents(calendar) {
  const timeMin = new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1).toISOString();
  const timeMax = new Date(currentDate.getFullYear(), currentDate.getMonth() + 2, 0).toISOString();
  
  const url = `https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(calendar.calendarId)}/events?key=${calendar.apiKey}&timeMin=${timeMin}&timeMax=${timeMax}&orderBy=startTime&singleEvents=true`;
  
  try {
    const response = await fetch(url);
    
    if (!response.ok) {
      const errorData = await response.json().catch(() => ({}));
      throw new Error(`API Ïò§Î•ò ${response.status}: ${errorData.error?.message || response.statusText}`);
    }
    
    const data = await response.json();
    
    calendar.events = data.items.map(event => formatGoogleEvent(event, calendar.color));
    addDebugLog(`API Ï∫òÎ¶∞Îçî Î°úÎìú ÏôÑÎ£å: ${calendar.events.length}Í∞ú Ïù¥Î≤§Ìä∏`);
    
  } catch (error) {
    addDebugLog(`API Ï∫òÎ¶∞Îçî Î°úÎìú Ïã§Ìå®: ${error.message}`);
    throw error;
  }
}

function formatGoogleEvent(event, color) {
  const startDate = event.start.dateTime || event.start.date;
  const endDate = event.end.dateTime || event.end.date;
  const startTime = new Date(startDate);
  const endTime = new Date(endDate);
  
  return {
    title: event.summary || 'Ï†úÎ™© ÏóÜÏùå',
    date: startTime.toISOString().split('T')[0],
    startTime: event.start.dateTime ? 
      startTime.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit', hour12: false }) :
      'Ï¢ÖÏùº',
    endTime: event.end.dateTime ? 
      endTime.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit', hour12: false }) :
      'Ï¢ÖÏùº',
    time: event.start.dateTime ? 
      startTime.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit', hour12: false }) :
      'Ï¢ÖÏùº',
    color: color,
    description: event.description || '',
    location: event.location || ''
  };
}

function generateSampleEvents() {
  const events = [];
  const today = new Date();
  
  for (let i = -7; i <= 14; i++) {
    const date = new Date(today);
    date.setDate(today.getDate() + i);
    
    if (Math.random() > 0.7) {
      events.push({
        title: `ÏÉòÌîå Ïù¥Î≤§Ìä∏ ${i + 8}`,
        date: date.toISOString().split('T')[0],
        time: Math.random() > 0.5 ? 'Ï¢ÖÏùº' : '14:00',
        startTime: Math.random() > 0.5 ? 'Ï¢ÖÏùº' : '14:00',
        endTime: Math.random() > 0.5 ? 'Ï¢ÖÏùº' : '15:00',
        description: 'Ïù¥Í≤ÉÏùÄ ÏÉòÌîå Ïù¥Î≤§Ìä∏ÏûÖÎãàÎã§.',
        location: ''
      });
    }
  }
  
  return events;
}
// ÎèÑÏõÄÎßê ÌëúÏãú
console.log('%cÎ©ÄÌã∞ Ï∫òÎ¶∞Îçî Î∑∞Ïñ¥ ÎîîÎ≤ÑÍ∑∏ ÎèÑÍµ¨%c\n' +
  'debugCalendar.showCalendars() - Î™®Îì† Ï∫òÎ¶∞Îçî Ï†ïÎ≥¥ ÌëúÏãú\n' +
  'debugCalendar.showEvents(Ï∫òÎ¶∞ÎçîID) - ÌäπÏ†ï Ï∫òÎ¶∞ÎçîÏùò Ïù¥Î≤§Ìä∏ ÌëúÏãú\n' +
  'debugCalendar.clearStorage() - Ï†ÄÏû•Îêú Îç∞Ïù¥ÌÑ∞ ÏÇ≠Ï†ú Î∞è ÏÉàÎ°úÍ≥†Ïπ®\n' +
  'debugCalendar.addKoreanHolidays() - ÌïúÍµ≠ Í≥µÌú¥Ïùº Ï∫òÎ¶∞Îçî Ï∂îÍ∞Ä\n' +
  'debugCalendar.addSampleCalendar() - ÏÉòÌîå Ï∫òÎ¶∞Îçî Ï∂îÍ∞Ä', 
  'color: #D1D1D1; font-weight: bold; font-size: 14px;', 
  'color: #333; font-size: 12px;');
</script>
</body>
</html>
